<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ hàng của bạn</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/js/all.min.js"
        integrity="sha512-b+nQTCdtTBIRIbraqNEwsjB6UvL3UEMkXnhzd8awtCYh0Kcsjl9uEgwVFVbhoj3uu1DO1ZMacNvLoyJJiNfcvg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Protest+Guerrilla&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/cart.css">
</head>

<body>
    <div class="container-fluid">
        <nav class="navbar navbar-expand-lg">
            <a class="navbar-brand" href="../index.html">Chợ Tết Online</a>
            <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
                style="border: none;">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="store.html" style="color: black;"><i class="fa-solid fa-basket-shopping"
                                style="color: red;"></i> Mua
                            sắm</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="cart.html" style="color: black;"><i class="fa-solid fa-cart-shopping"
                                style="color: orange;"></i> Giỏ hàng</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="login.html" style="color: black;"><i class="fa-solid fa-right-to-bracket"
                                style="color: green;"></i> Đăng
                            nhập</a>
                    </li>
                </ul>
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Công cụ khác
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li class="nav-item">
                            <a class="dropdown-item" href="contact.html" style="color: yellow;"><i class="fa-solid fa-headset"></i>
                                Liên
                                hệ với chúng tôi</a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li class="nav-item">
                            <a class="dropdown-item" href="download.html" style="color: yellow;"><i
                                    class="fa-solid fa-download"></i>
                                Tải
                                xuống ứng dụng</a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li class="nav-item">
                            <a class="dropdown-item" href="send.html" style="color: yellow;"><i
                                    class="fa-solid fa-cloud-arrow-up"></i>
                                Đăng bán sản phẩm</a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                    </ul>
                </div>
                </ul>
            </div>
        </nav>
        <div class="row header">
            <div class="">
                <h1 class="big-heading title mt-4">Giỏ hàng của bạn</h1>
                <p class="require-p">Xem trước sản phẩm được thêm của bạn trước khi thanh toán ngay tại đây!</p>
                <a href="store.html"><button type="button" class="btn btn-outline-light btn-lg goto-buttons mt-4"><i
                            class="fa-solid fa-circle-right"></i>
                        Tiếp tục mua sắm trên website</button></a>
                <p class="mt-3">--------------- hoặc ---------------</p>
                <a href="download.html"><button type="button" class="btn btn-outline-light btn-lg mb-5 goto-buttons"><i
                            class="fa-solid fa-circle-right"></i>
                        Tải ứng dụng mua hàng</button></a>
            </div>
        </div>
    </div>
    <div class="container-fluid" id="features">
        <div class="row">
            <!-- <h4>Tìm kiếm trong giỏ hàng</h4>
            <div class="input-group rounded search mt-3 mb-5">
                <input type="search" class="form-control rounded" placeholder="Tìm kiếm sản phẩm" aria-label="Search"
                    aria-describedby="search-addon" />
                <span class="input-group-text border-0" id="search-addon">
                    <i class="fas fa-search"></i>
                </span>
            </div> -->
            <h1>Tình trạng giỏ hàng</h1>
            <div class="cart-container"></div>
            <div class="content_box">
            </div>
            <div id="totalPriceElement" class="total-price"></div>
        </div>
    </div>
    <div class="container-fluid end">
        <h3 id="last-section">Siêu thị online uy tín, chất lượng cao!</h3>
        <p id="note-p">Chúng tôi luôn bán hàng uy tín, đạt chất lượng cao!</p>
        <a href="store.html"><button type="button" class="btn btn-outline-light btn-lg goto2-buttons"><i
                    class="fa-solid fa-circle-right"></i>
                Tiếp tục mua sắm trên website</button></a>
        <p class="mt-3">--------------- hoặc ---------------</p>
        <a href="download.html"><button type="button" class="btn btn-outline-light btn-lg goto2-buttons mt-2"><i
                    class="fa-solid fa-circle-right"></i>
                Tải ứng dụng xuống ngay!</button></a>
    </div>
    </div>

    <!-- Footer -->

    <div class="container-fluid" id="footer">
        <a class="a btn " role="button" href="https://www.youtube.com/channel/UCMaj6Ou0jF_bcgDg86yAD7A"
            target="_blank"><i class="fa-brands fa-youtube icon"></i></a>
        <a class="a btn " role="button" href="https://x.com/DuyNguyenHuu08" target="_blank"><i
                class="fa-brands fa-x-twitter icon1"></i></a>
        <a class="a btn " role="button" href="https://github.com/NguyenHuuDuy2011" target="_blank"><i
                class="fa-brands fa-github icon1"></i></a>
        <br>
        <br>
        <p id="features-p">© Copyright by Nguyễn Hữu Duy Corporation 2024 - All right reserved</p>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const cartContainer = document.querySelector('.content_box'); // Khu vực hiển thị sản phẩm
            const cartContainer2 = document.querySelector('.cart-container'); // Khu vực hiển thị sản phẩm
            const totalPriceElement = document.getElementById('totalPriceElement'); // Khu vực hiển thị tổng giá trị giỏ hàng
            totalPriceElement.className = "total-price mt-4";

            // Lấy danh sách sản phẩm từ localStorage
            const productList = JSON.parse(localStorage.getItem('products')) || [];

            // Kiểm tra nếu giỏ hàng rỗng
            if (productList.length === 0) {
                cartContainer2.innerHTML = '<h5 class="mt-3">Chưa có sản phẩm nào trong giỏ hàng!</h5>';
                cartContainer2.innerHTML += '<a href="store.html"><button type="button" class="btn btn-light btn-lg shop-button mt-5 mb-5"><i class="fa-solid fa-circle-right"></i> Mua hàng ngay tại đây!</button></a>';
                return;
            }

            let totalCartPrice = 0; // Biến lưu tổng giá trị giỏ hàng

            // Duyệt qua từng sản phẩm và hiển thị
            productList.forEach((product, index) => {
                const productDiv = document.createElement('div');
                productDiv.classList.add('product-item', 'mb-4');

                // Cập nhật tổng giá trị giỏ hàng
                const itemTotalPrice = product.price * (product.quantity || 1);
                totalCartPrice += itemTotalPrice;

                // Nội dung sản phẩm
                const contentBox = document.querySelector('.content_box'); // Lấy thẻ chứa sản phẩm
                const newProductDiv = document.createElement('div'); // Tạo div mới cho sản phẩm
                newProductDiv.className = 'content1'; // Thêm class cho sản phẩm
                newProductDiv.innerHTML = `
                    <img src="${product.img_path}" alt="${product.title}" class="img-fluid mb-2" style="max-width: 150px;">
                    <h5 class="product-title">${product.title}</h5>
                    <p class="product-info">${product.des}</p>
                    <p class="product-cost">Giá/1 sản phẩm: ${product.price.toLocaleString('vi-VN')}.000 VNĐ</p>
                    <p>Số lượng: ${product.quantity || 1}</p>
                    <p>Tổng giá trị sản phẩm: ${itemTotalPrice.toLocaleString('vi-VN')}.000 VNĐ</p>
                    <button class="btn btn-danger btn-sm remove-btn mt-3 remove" data-index="${index}"><i class="fa-solid fa-trash fa-xl" style="color: #ffffff;"></i> Xóa sản phẩm</button>
                    <a href="pay.html" target="_blank"><button class="btn btn-light btn-lg download-buttons mt-3"><i
                        class="fa-solid fa-circle-right"></i> Mua ngay!</button></a>
                `;
                contentBox.appendChild(newProductDiv); // Thêm sản phẩm mới vào .content_box


                // cartContainer.appendChild(productDiv);
            });

            // Thêm tổng giá trị giỏ hàng
            totalPriceElement.innerHTML = `
                <h4>Tổng giá trị giỏ hàng: ${totalCartPrice.toLocaleString('vi-VN')}.000 VNĐ</h4>
                <a href="store.html"><button type="button" class="btn btn-light btn-lg shop-button mt-4"><i class="fa-solid fa-circle-right"></i> Tiếp tục mua sắm</button></a>
            `;
            cartContainer.appendChild(totalPriceElement);

            // Thêm sự kiện để xóa sản phẩm
            document.querySelectorAll('.remove-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productIndex = e.target.getAttribute('data-index');
                    removeProductFromCart(productIndex);
                });
            });
        });

        // Hàm xóa sản phẩm khỏi giỏ hàng
        function removeProductFromCart(index) {
            let productList = JSON.parse(localStorage.getItem('products')) || [];
            productList.splice(index, 1); // Xóa sản phẩm tại vị trí được chỉ định

            // Cập nhật lại localStorage
            localStorage.setItem('products', JSON.stringify(productList));

            // Cập nhật lại giao diện
            location.reload(); // Tải lại trang để hiển thị giỏ hàng mới
        }             
    </script>

</body>

</html>